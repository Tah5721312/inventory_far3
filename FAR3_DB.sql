-- ===============================================
-- 1. الجداول المرجعية الأساسية (يجب إنشاؤها أولاً)
-- ===============================================

-- جدول الأدوار (Roles)
CREATE TABLE far3.ROLES (
    ROLE_ID NUMBER PRIMARY KEY,
    NAME VARCHAR2(50) UNIQUE NOT NULL,
    DESCRIPTION VARCHAR2(255),
    IS_ACTIVE NUMBER(1) DEFAULT 1,
    CREATED_AT DATE DEFAULT DATE DEFAULT SYSDATE,
    UPDATED_AT  DATE DEFAULT DATE DEFAULT SYSDATE
);

-- جدول الأقسام (Departments)
CREATE TABLE far3.DEPARTMENTS (
    DEPT_ID NUMBER PRIMARY KEY,
    DEPT_NAME VARCHAR2(200) NOT NULL UNIQUE,
    CREATED_AT DATE DEFAULT SYSDATE
);

-- جدول الرتب/التصنيفات (Ranks)
CREATE TABLE far3.RANKS (
    RANK_ID NUMBER PRIMARY KEY,
    RANK_NAME VARCHAR2(100) NOT NULL UNIQUE,
    CREATED_AT DATE DEFAULT SYSDATE
);

-- جدول الطوابق (Floors)
CREATE TABLE far3.FLOORS (
    FLOOR_ID NUMBER PRIMARY KEY,
    FLOOR_NAME VARCHAR2(100) NOT NULL UNIQUE,
    CREATED_AT DATE DEFAULT SYSDATE
);

-- ===============================================
-- 2. جدول المستخدمين (مع جميع العلاقات)
-- ===============================================

CREATE TABLE far3.USERS (
    USER_ID NUMBER PRIMARY KEY,
    USERNAME VARCHAR2(100) NOT NULL UNIQUE,
    EMAIL VARCHAR2(255) NOT NULL UNIQUE,
    PASSWORD VARCHAR2(255) NOT NULL,
    ROLE_ID NUMBER NOT NULL,
    FULL_NAME VARCHAR2(200),
    IS_ADMIN NUMBER(1) DEFAULT 0,
    PHONE VARCHAR2(20),
    IS_ACTIVE NUMBER(1) DEFAULT 1,
    RANK_ID NUMBER,
    DEPT_ID NUMBER,
    FLOOR_ID NUMBER,
    CREATED_AT DATE DEFAULT SYSDATE,
    UPDATED_AT DATE DEFAULT SYSDATE,
    -- Foreign Keys
    CONSTRAINT FK_USER_ROLE FOREIGN KEY (ROLE_ID) 
        REFERENCES far3.ROLES(ROLE_ID) ON DELETE SET NULL,
    CONSTRAINT FK_USER_RANK FOREIGN KEY (RANK_ID) 
        REFERENCES far3.RANKS(RANK_ID) ON DELETE SET NULL,
    CONSTRAINT FK_USER_DEPT FOREIGN KEY (DEPT_ID) 
        REFERENCES far3.DEPARTMENTS(DEPT_ID) ON DELETE SET NULL,
    CONSTRAINT FK_USER_FLOOR FOREIGN KEY (FLOOR_ID) 
        REFERENCES far3.FLOORS(FLOOR_ID) ON DELETE SET NULL
);

-- ===============================================
-- 3. جدول صلاحيات الأدوار
-- ===============================================

CREATE TABLE far3.ROLE_PERMISSIONS (
    ROLE_PERMISSIONS_ID NUMBER PRIMARY KEY,
    ROLE_ID NUMBER NOT NULL,
    SUBJECT VARCHAR2(50) NOT NULL,
    ACTION VARCHAR2(50) NOT NULL,
    FIELD_NAME VARCHAR2(100),
    CAN_ACCESS NUMBER(1) DEFAULT 1,
    CREATED_AT DATE DEFAULT SYSDATE,
    CONSTRAINT FK_RP_ROLE FOREIGN KEY (ROLE_ID) 
        REFERENCES far3.ROLES(ROLE_ID) ON DELETE CASCADE,
    CONSTRAINT UK_RP UNIQUE (ROLE_ID, SUBJECT, ACTION, FIELD_NAME)
);

-- ===============================================
-- 4. جداول التصنيفات (Categories Hierarchy)
-- ===============================================

-- التصنيفات الرئيسية
CREATE TABLE far3.MAIN_CATEGORIES (
    CAT_ID NUMBER PRIMARY KEY,
    CAT_NAME VARCHAR2(200) NOT NULL UNIQUE,
    DESCRIPTION VARCHAR2(500),
    CREATED_AT DATE DEFAULT SYSDATE
);

-- التصنيفات الفرعية
CREATE TABLE far3.SUB_CATEGORIES (
    SUB_CAT_ID NUMBER PRIMARY KEY,
    SUB_CAT_NAME VARCHAR2(200) NOT NULL,
    CAT_ID NUMBER NOT NULL,
    DESCRIPTION VARCHAR2(500),
    CREATED_AT DATE DEFAULT SYSDATE,
    CONSTRAINT FK_SUBCAT_MAINCAT FOREIGN KEY (CAT_ID) 
        REFERENCES far3.MAIN_CATEGORIES(CAT_ID) ON DELETE CASCADE,
    CONSTRAINT UK_SUBCAT_NAME_CAT UNIQUE (SUB_CAT_NAME, CAT_ID)
);

-- أنواع الأصناف
CREATE TABLE far3.ITEM_TYPES (
    ITEM_TYPE_ID NUMBER PRIMARY KEY,
    ITEM_TYPE_NAME VARCHAR2(200) NOT NULL UNIQUE,
    SUB_CAT_ID NUMBER NOT NULL,
    CREATED_AT DATE DEFAULT SYSDATE,
    CONSTRAINT FK_ITEMTYPE_SUBCAT FOREIGN KEY (SUB_CAT_ID) 
        REFERENCES far3.SUB_CATEGORIES(SUB_CAT_ID) ON DELETE CASCADE
);

-- ===============================================
-- 5. جدول الأصناف الرئيسي (مع جميع العلاقات)
-- ===============================================

CREATE TABLE far3.ITEMS (
    ITEM_ID NUMBER PRIMARY KEY,
    ITEM_NAME VARCHAR2(300) NOT NULL,
    SUB_CAT_ID NUMBER,
    ITEM_TYPE_ID NUMBER,
    LOCK_NUM NUMBER,
    SERIAL VARCHAR2(100),
    KIND VARCHAR2(100),
    SITUATION VARCHAR2(200),
    PROPERTIES VARCHAR2(400),
    HDD VARCHAR2(100),
    RAM VARCHAR2(100),
    IP VARCHAR2(50),
    COMP_NAME VARCHAR2(200),
    USER_ID NUMBER,
    DEPT_ID NUMBER,
    FLOOR_ID NUMBER,
    CREATED_AT DATE DEFAULT SYSDATE,
    UPDATED_AT DATE DEFAULT SYSDATE,
    -- Foreign Keys
    CONSTRAINT FK_ITEM_SUBCAT FOREIGN KEY (SUB_CAT_ID) 
        REFERENCES far3.SUB_CATEGORIES(SUB_CAT_ID) ON DELETE SET NULL,
    CONSTRAINT FK_ITEM_TYPE FOREIGN KEY (ITEM_TYPE_ID) 
        REFERENCES far3.ITEM_TYPES(ITEM_TYPE_ID) ON DELETE SET NULL,
    CONSTRAINT FK_ITEM_USER FOREIGN KEY (USER_ID) 
        REFERENCES far3.USERS(USER_ID) ON DELETE SET NULL,
    CONSTRAINT FK_ITEM_DEPT FOREIGN KEY (DEPT_ID) 
        REFERENCES far3.DEPARTMENTS(DEPT_ID) ON DELETE SET NULL,
    CONSTRAINT FK_ITEM_FLOOR FOREIGN KEY (FLOOR_ID) 
        REFERENCES far3.FLOORS(FLOOR_ID) ON DELETE SET NULL
);

-- ===============================================
-- 6. Indexes لتحسين الأداء
-- ===============================================

-- Indexes على USERS
CREATE INDEX far3.IDX_USER_ROLE ON far3.USERS(ROLE_ID);
CREATE INDEX far3.IDX_USER_RANK ON far3.USERS(RANK_ID);
CREATE INDEX far3.IDX_USER_DEPT ON far3.USERS(DEPT_ID);
CREATE INDEX far3.IDX_USER_FLOOR ON far3.USERS(FLOOR_ID);
CREATE INDEX far3.IDX_USER_EMAIL ON far3.USERS(EMAIL);
CREATE INDEX far3.IDX_USER_ACTIVE ON far3.USERS(IS_ACTIVE);

-- Indexes على ITEMS
CREATE INDEX far3.IDX_ITEM_SUBCAT ON far3.ITEMS(SUB_CAT_ID);
CREATE INDEX far3.IDX_ITEM_TYPE ON far3.ITEMS(ITEM_TYPE_ID);
CREATE INDEX far3.IDX_ITEM_USER ON far3.ITEMS(USER_ID);
CREATE INDEX far3.IDX_ITEM_DEPT ON far3.ITEMS(DEPT_ID);
CREATE INDEX far3.IDX_ITEM_FLOOR ON far3.ITEMS(FLOOR_ID);
CREATE INDEX far3.IDX_ITEM_SERIAL ON far3.ITEMS(SERIAL);
CREATE INDEX far3.IDX_ITEM_IP ON far3.ITEMS(IP);

-- Indexes على التصنيفات
CREATE INDEX far3.IDX_SUBCAT_MAINCAT ON far3.SUB_CATEGORIES(CAT_ID);
CREATE INDEX far3.IDX_ITEMTYPE_SUBCAT ON far3.ITEM_TYPES(SUB_CAT_ID);

-- ===============================================
-- 7. Sequences للـ Primary Keys (اختياري)
-- ===============================================

CREATE SEQUENCE far3.ROLE_ID START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE far3.USER_ID START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE far3.ROLE_PERM_ID START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE far3.CAT_ID START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE far3.SUBCAT_ID START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE far3.ITEMTYPE_ID START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE far3.ITEM_ID START WITH 1 INCREMENT BY 1;


CREATE OR REPLACE TRIGGER far3.trg_USERS_id
BEFORE INSERT ON far3.USERS
FOR EACH ROW
BEGIN
  :NEW.USER_ID := TO_NUMBER('45' || far3.USER_ID.NEXTVAL);
END;
/

CREATE OR REPLACE TRIGGER far3.trg_ROLE_ID
BEFORE INSERT ON far3.ROLES
FOR EACH ROW
BEGIN
  :NEW.ROLE_ID := TO_NUMBER('21' || far3.ROLE_ID.NEXTVAL);
END;
/

CREATE OR REPLACE TRIGGER far3.trg_ROLE_PERM_ID
BEFORE INSERT ON far3.ROLE_PERMISSIONS
FOR EACH ROW
BEGIN
  :NEW.ROLE_PERMISSIONS_ID := TO_NUMBER('65' || far3.ROLE_PERM_ID.NEXTVAL);
END;
/


CREATE OR REPLACE TRIGGER far3.trg_CAT_ID
BEFORE INSERT ON far3.MAIN_CATEGORIES
FOR EACH ROW
BEGIN
  :NEW.CAT_ID := TO_NUMBER('55' || far3.CAT_ID.NEXTVAL);
END;
/


CREATE OR REPLACE TRIGGER far3.trg_SUBCAT_ID
BEFORE INSERT ON far3.SUB_CATEGORIES
FOR EACH ROW
BEGIN
  :NEW.SUB_CAT_ID := TO_NUMBER('60' || far3.SUBCAT_ID.NEXTVAL);
END;
/


CREATE OR REPLACE TRIGGER far3.trg_ITEMTYPE_ID
BEFORE INSERT ON far3.ITEM_TYPES
FOR EACH ROW
BEGIN
  :NEW.ITEM_TYPE_ID := TO_NUMBER('75' || far3.ITEMTYPE_ID.NEXTVAL);
END;
/


CREATE OR REPLACE TRIGGER far3.trg_ITEM_ID
BEFORE INSERT ON far3.ITEMS
FOR EACH ROW
BEGIN
  :NEW.ITEM_ID := TO_NUMBER('85' || far3.ITEM_ID.NEXTVAL);
END;
/


-- ===============================================
-- 8. Comments على الجداول والأعمدة (للتوثيق)
-- ===============================================

COMMENT ON TABLE far3.USERS IS 'جدول المستخدمين الرئيسي';
COMMENT ON COLUMN far3.USERS.USER_ID IS 'معرف المستخدم الفريد';
COMMENT ON COLUMN far3.USERS.ROLE_ID IS 'الدور الوظيفي للمستخدم';
COMMENT ON COLUMN far3.USERS.RANK_ID IS 'الرتبة أو الدرجة الوظيفية';
COMMENT ON COLUMN far3.USERS.DEPT_ID IS 'القسم التابع له المستخدم';
COMMENT ON COLUMN far3.USERS.FLOOR_ID IS 'الطابق الذي يعمل فيه المستخدم';

COMMENT ON TABLE far3.ITEMS IS 'جدول الأصناف والأجهزة';
COMMENT ON COLUMN far3.ITEMS.USER_ID IS 'المستخدم المسؤول عن الصنف';
COMMENT ON COLUMN far3.ITEMS.DEPT_ID IS 'القسم التابع له الصنف';
COMMENT ON COLUMN far3.ITEMS.FLOOR_ID IS 'الطابق الموجود فيه الصنف';

--****************************----------
-- إدخال البيانات الأساسية للأدوار (نظام المخزون)
INSERT INTO far3.ROLES (NAME, DESCRIPTION) VALUES 
('SUPER_ADMIN', 'مدير النظام الرئيسي - صلاحيات كاملة على جميع الوحدات');
INSERT INTO far3.ROLES (NAME, DESCRIPTION) VALUES 
('ADMIN', 'مدير النظام - صلاحيات إدارية شاملة');
INSERT INTO far3.ROLES (NAME, DESCRIPTION) VALUES 
('INVENTORY_MANAGER', 'مدير المخزون - إدارة الأصناف والتصنيفات والأقسام');
INSERT INTO far3.ROLES (NAME, DESCRIPTION) VALUES 
('INVENTORY_USER', 'موظف المخزون - عرض وتحديث الأصناف المسؤولة عنها');
INSERT INTO far3.ROLES (NAME, DESCRIPTION) VALUES 
('VIEWER', 'مستعرض - عرض البيانات والإحصائيات فقط');
INSERT INTO far3.ROLES (NAME, DESCRIPTION) VALUES 
('USER', 'مستخدم عادي - عرض الأصناف المخصصة له فقط');


-------------------************************-----------


-- ===============================================
-- صلاحيات الأدوار لنظام المخزون (Inventory System)
-- ===============================================

-- 1. SUPER_ADMIN (ROLE_ID = 211) - كل الصلاحيات على جميع الوحدات
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (211, 'ALL', 'MANAGE');

-- 2. ADMIN (ROLE_ID = 212) - صلاحيات إدارية شاملة
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (212, 'ITEMS', 'CREATE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (212, 'ITEMS', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (212, 'ITEMS', 'UPDATE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (212, 'ITEMS', 'DELETE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (212, 'USERS', 'CREATE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (212, 'USERS', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (212, 'USERS', 'UPDATE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (212, 'USERS', 'DELETE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (212, 'CATEGORIES', 'CREATE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (212, 'CATEGORIES', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (212, 'CATEGORIES', 'UPDATE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (212, 'CATEGORIES', 'DELETE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (212, 'DEPARTMENTS', 'CREATE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (212, 'DEPARTMENTS', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (212, 'DEPARTMENTS', 'UPDATE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (212, 'DEPARTMENTS', 'DELETE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (212, 'RANKS', 'CREATE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (212, 'RANKS', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (212, 'RANKS', 'UPDATE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (212, 'RANKS', 'DELETE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (212, 'FLOORS', 'CREATE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (212, 'FLOORS', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (212, 'FLOORS', 'UPDATE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (212, 'FLOORS', 'DELETE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (212, 'STATISTICS', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (212, 'DASHBOARD', 'READ');

-- 3. INVENTORY_MANAGER (ROLE_ID = 213) - مدير المخزون
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (213, 'ITEMS', 'CREATE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (213, 'ITEMS', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (213, 'ITEMS', 'UPDATE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (213, 'ITEMS', 'DELETE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (213, 'CATEGORIES', 'CREATE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (213, 'CATEGORIES', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (213, 'CATEGORIES', 'UPDATE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (213, 'CATEGORIES', 'DELETE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (213, 'DEPARTMENTS', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (213, 'RANKS', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (213, 'FLOORS', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (213, 'STATISTICS', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (213, 'DASHBOARD', 'READ');

-- 4. INVENTORY_USER (ROLE_ID = 214) - موظف المخزون
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (214, 'ITEMS', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (214, 'ITEMS', 'UPDATE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (214, 'CATEGORIES', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (214, 'DEPARTMENTS', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (214, 'RANKS', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (214, 'FLOORS', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (214, 'STATISTICS', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (214, 'DASHBOARD', 'READ');

-- 5. VIEWER (ROLE_ID = 215) - مستعرض (عرض فقط)
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (215, 'ITEMS', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (215, 'CATEGORIES', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (215, 'DEPARTMENTS', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (215, 'RANKS', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (215, 'FLOORS', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (215, 'STATISTICS', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (215, 'DASHBOARD', 'READ');

-- 6. USER (ROLE_ID = 216) - مستخدم عادي (عرض الأصناف المخصصة له فقط)
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) VALUES (216, 'ITEMS', 'READ');

COMMIT;




-- إدراج المستخدمين
INSERT INTO far3.USERS (USERNAME, EMAIL, PASSWORD, ROLE_ID, FULL_NAME, PHONE) 
VALUES ('superadmin', 'superadmin@hospital.com', 
        '$2b$10$RHiiqr3N2CYhRb1xQtlZNuqvFaZ/vrDWNxStJEXeg3QDC68K2flFa', 
        211, 'محمد أحمد', '01000000001');

INSERT INTO far3.USERS (USERNAME, EMAIL, PASSWORD, ROLE_ID, FULL_NAME, PHONE) 
VALUES ('tah', 'tah@gmail.com', 
        '$2b$10$RHiiqr3N2CYhRb1xQtlZNuqvFaZ/vrDWNxStJEXeg3QDC68K2flFa', 
        211, 'طه محمود', '01000000002');

INSERT INTO far3.USERS (USERNAME, EMAIL, PASSWORD, ROLE_ID, FULL_NAME, PHONE) 
VALUES ('admin', 'admin@hospital.com', 
        '$2b$10$hashedpassword2', 
        212, 'أحمد محمد', '01100000001');

INSERT INTO far3.USERS (USERNAME, EMAIL, PASSWORD, ROLE_ID, FULL_NAME, PHONE) 
VALUES ('sara.ali', 'sara.ali@example.com', 
        '$2b$10$hashedpassword4', 
        213, 'د. سارة علي', '01200000001');

INSERT INTO far3.USERS (USERNAME, EMAIL, PASSWORD, ROLE_ID, FULL_NAME, PHONE) 
VALUES ('nurse1', 'nurse1@hospital.com', 
        '$2b$10$hashedpassword5', 
        214, 'فاطمة أحمد', '01300000001');

INSERT INTO far3.USERS (USERNAME, EMAIL, PASSWORD, ROLE_ID, FULL_NAME, PHONE) 
VALUES ('reception1', 'reception@hospital.com', 
        '$2b$10$hashedpassword6', 
        215, 'أحمد إبراهيم', '01400000001');

INSERT INTO far3.USERS (USERNAME, EMAIL, PASSWORD, ROLE_ID, FULL_NAME, PHONE) 
VALUES ('tag', 'tag@gmail.com', 
        '$2b$10$U0Pn9va0UGCz1f.ELBu1i.J4wpMvQL89Iq2GLbsIQsvGs2/YKAE.i', 
        215, 'تاج الدين', '01400000002');

INSERT INTO far3.USERS (USERNAME, EMAIL, PASSWORD, ROLE_ID, FULL_NAME, PHONE) 
VALUES ('taha', 'taha@gmail.com', 
        '$2b$10$R424EWT39jqoRGGZnuRxnOzV.uaIgHkznZ.OeBrkXC5cHQ0RoErwq', 
        216, 'طه محمد', '01500000001');

INSERT INTO far3.USERS (USERNAME, EMAIL, PASSWORD, ROLE_ID, FULL_NAME, PHONE) 
VALUES ('tah0', 'tah0@gmail.com', 
        '$2b$10$BZhUtKQCVkUXQ/gmAGJMr.1xDGk58Gp.gHzU5i5J5M4afFLJlxPr.', 
        216, 'طه علي', '01500000002');

COMMIT;


---************************-----------
-- إدراج أقسام افتراضية
INSERT INTO FAR3.Departments (dept_id, dept_name) VALUES (1, 'قسم تكنولوجيا المعلومات');
INSERT INTO FAR3.Departments (dept_id, dept_name) VALUES (2, 'قسم الموارد البشرية');
INSERT INTO FAR3.Departments (dept_id, dept_name) VALUES (3, 'قسم المالية');
INSERT INTO far3.DEPARTMENTS (DEPT_ID, DEPT_NAME) VALUES (7, 'تقنية المعلومات');
INSERT INTO far3.DEPARTMENTS (DEPT_ID, DEPT_NAME) VALUES (8, 'المالية');
INSERT INTO far3.DEPARTMENTS (DEPT_ID, DEPT_NAME) VALUES (9, 'الموارد البشرية');
INSERT INTO far3.DEPARTMENTS (DEPT_ID, DEPT_NAME) VALUES (4, 'التسويق');
INSERT INTO far3.DEPARTMENTS (DEPT_ID, DEPT_NAME) VALUES (5, 'العمليات');
INSERT INTO far3.DEPARTMENTS (DEPT_ID, DEPT_NAME) VALUES (6, 'خدمة العملاء');
-- الطوابق
INSERT INTO far3.FLOORS (FLOOR_ID, FLOOR_NAME) VALUES (1, 'الطابق الأرضي');
INSERT INTO far3.FLOORS (FLOOR_ID, FLOOR_NAME) VALUES (2, 'الطابق الأول');
INSERT INTO far3.FLOORS (FLOOR_ID, FLOOR_NAME) VALUES (3, 'الطابق الثاني');
INSERT INTO far3.FLOORS (FLOOR_ID, FLOOR_NAME) VALUES (4, 'الطابق الثالث');


-- الرتب
INSERT INTO far3.RANKS (RANK_ID, RANK_NAME) VALUES (6, 'مدير عام');
INSERT INTO far3.RANKS (RANK_ID, RANK_NAME) VALUES (7, 'مدير إدارة');
INSERT INTO far3.RANKS (RANK_ID, RANK_NAME) VALUES (3, 'رئيس قسم');
INSERT INTO far3.RANKS (RANK_ID, RANK_NAME) VALUES (4, 'موظف أول');
INSERT INTO far3.RANKS (RANK_ID, RANK_NAME) VALUES (5, 'موظف');
-- إدراج طوابق افتراضية
INSERT INTO FAR3.Floors (floor_id, floor_name) VALUES (1, 'الطابق الأول');
INSERT INTO FAR3.Floors (floor_id, floor_name) VALUES (2, 'الطابق الثاني');
INSERT INTO FAR3.Floors (floor_id, floor_name) VALUES (3, 'الطابق الثالث');

-- إدراج تصنيفات رئيسية
INSERT INTO FAR3.Main_Categories ( cat_name, description) VALUES ( 'أجهزة حاسوب', 'أجهزة حاسوب وملحقاتها');
INSERT INTO FAR3.Main_Categories ( cat_name, description) VALUES ( 'أثاث مكتبي', 'أثاث وتجهيزات المكاتب');
INSERT INTO far3.MAIN_CATEGORIES ( CAT_NAME, DESCRIPTION) VALUES ( 'الشبكات', 'معدات الشبكات والاتصالات');

-- إدراج تصنيفات فرعية
INSERT INTO FAR3.Sub_Categories ( sub_cat_name, cat_id) VALUES ( 'حاسوب محمول', 551);
INSERT INTO FAR3.Sub_Categories ( sub_cat_name, cat_id) VALUES ( 'حاسوب مكتبي', 551);
INSERT INTO FAR3.Sub_Categories ( sub_cat_name, cat_id) VALUES ( 'مكاتب', 552);

COMMIT;

-- أنواع الأصناف
INSERT INTO far3.ITEM_TYPES ( ITEM_TYPE_NAME, SUB_CAT_ID) 
VALUES ( 'Dell Desktop', 651);

INSERT INTO far3.ITEM_TYPES ( ITEM_TYPE_NAME, SUB_CAT_ID) 
VALUES ( 'HP Laptop', 652);

INSERT INTO far3.ITEM_TYPES ( ITEM_TYPE_NAME, SUB_CAT_ID) 
VALUES ( 'Canon Printer', 653);


---***************************-----------

-- ===============================================
-- 3. بيانات الأصناف (ITEMS) - 50 سجل
-- ===============================================

-- أجهزة كمبيوتر مكتبية (Desktop)
INSERT INTO far3.ITEMS ( ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'Dell OptiPlex 7090', 651, 751, 1001, 'DL-2023-001', 'Desktop', 'جيد', '512GB SSD', '16GB', '192.168.1.10', 'PC-ADMIN-01', 452, 1, 1);


INSERT INTO far3.ITEMS ( ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'HP EliteDesk 800 G6', 651, 751, 1002, 'HP-2023-002', 'Desktop', 'جيد', '1TB HDD', '8GB', '192.168.1.11', 'PC-IT-01', 452, 1, 2);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'Dell OptiPlex 5080', 651, 751, 1003, 'DL-2023-003', 'Desktop', 'متوسط', '256GB SSD', '8GB', '192.168.1.12', 'PC-FIN-01', 453, 2, 2);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'Lenovo ThinkCentre M920', 651, 751, 1004, 'LN-2023-004', 'Desktop', 'جيد', '512GB SSD', '16GB', '192.168.1.13', 'PC-HR-01', 454, 3, 3);



INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'HP ProDesk 600 G5', 651, 751, 1005, 'HP-2023-005', 'Desktop', 'جيد', '1TB HDD', '8GB', '192.168.1.14', 'PC-MKT-01', 455, 4, 3);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'Dell OptiPlex 3080', 651, 751, 1006, 'DL-2022-006', 'Desktop', 'متوسط', '256GB SSD', '8GB', '192.168.1.15', 'PC-OPS-01', NULL, 5, 2);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'HP EliteDesk 800 G5', 651, 751, 1007, 'HP-2022-007', 'Desktop', 'جيد', '512GB SSD', '16GB', '192.168.1.16', 'PC-CS-01', NULL, 6, 1);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'Dell OptiPlex 7080', 651, 751, 1008, 'DL-2022-008', 'Desktop', 'سيء', '256GB SSD', '8GB', '192.168.1.17', 'PC-IT-02', 456, 1, 1);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'Lenovo ThinkCentre M720', 651, 751, 1009, 'LN-2023-009', 'Desktop', 'جيد', '1TB HDD', '8GB', '192.168.1.18', 'PC-FIN-02', 453, 2, 2);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'HP ProDesk 400 G7', 651, 751, 1010, 'HP-2023-010', 'Desktop', 'جيد', '512GB SSD', '16GB', '192.168.1.19', 'PC-HR-02', 454, 3, 3);

-- أجهزة لابتوب (Laptops)
INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'HP EliteBook 840 G8', 652, 752, 2001, 'HPL-2023-011', 'Laptop', 'جيد', '512GB SSD', '16GB', 'DHCP', 'LT-ADMIN-01', 452, 1, 1);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'Dell Latitude 5420', 652, 752, 2002, 'DLL-2023-012', 'Laptop', 'جيد', '256GB SSD', '8GB', 'DHCP', 'LT-IT-01', 452, 1, 2);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'Lenovo ThinkPad T14', 652, 752, 2003, 'LNL-2023-013', 'Laptop', 'متوسط', '512GB SSD', '16GB', 'DHCP', 'LT-FIN-01', 453, 2, 2);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'HP ProBook 450 G8', 652, 752, 2004, 'HPL-2023-014', 'Laptop', 'جيد', '256GB SSD', '8GB', 'DHCP', 'LT-HR-01', 454, 3, 3);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'Dell Inspiron 15 3000', 652, 752, 2005, 'DLL-2022-015', 'Laptop', 'جيد', '1TB HDD', '8GB', 'DHCP', 'LT-MKT-01', 455, 4, 3);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'HP EliteBook 850 G7', 652, 752, 2006, 'HPL-2022-016', 'Laptop', 'متوسط', '512GB SSD', '16GB', 'DHCP', 'LT-OPS-01', NULL, 5, 2);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'Lenovo ThinkPad E15', 652, 752, 2007, 'LNL-2023-017', 'Laptop', 'جيد', '256GB SSD', '8GB', 'DHCP', 'LT-CS-01', NULL, 6, 1);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ('Dell Latitude 7420', 652, 752, 2008, 'DLL-2023-018', 'Laptop', 'جيد', '512GB SSD', '16GB', 'DHCP', 'LT-IT-02', 456, 1, 1);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'HP ZBook 15 G8', 652, 752, 2009, 'HPL-2023-019', 'Laptop', 'سيء', '1TB SSD', '32GB', 'DHCP', 'LT-FIN-02', 453, 2, 2);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'Lenovo ThinkPad X1 Carbon', 652, 752, 2010, 'LNL-2023-020', 'Laptop', 'جيد', '512GB SSD', '16GB', 'DHCP', 'LT-HR-02', 454, 3, 3);

-- طابعات (Printers)
INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'HP LaserJet Pro MFP M428', 653, 753, 3001, 'PRT-2023-021', 'Printer', 'جيد', NULL, NULL, '192.168.1.50', 'PRINTER-IT-01', NULL, 1, 2);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'Canon imageCLASS MF445dw', 653, 753, 3002, 'PRT-2023-022', 'Printer', 'جيد', NULL, NULL, '192.168.1.51', 'PRINTER-FIN-01', NULL, 2, 2);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'HP Color LaserJet Pro M454', 653, 753, 3003, 'PRT-2023-023', 'Printer', 'متوسط', NULL, NULL, '192.168.1.52', 'PRINTER-HR-01', NULL, 3, 3);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'Canon PIXMA G6020', 653, 753, 3004, 'PRT-2022-024', 'Printer', 'جيد', NULL, NULL, '192.168.1.53', 'PRINTER-MKT-01', NULL, 4, 3);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'HP OfficeJet Pro 9025', 653, 753, 3005, 'PRT-2023-025', 'Printer', 'جيد', NULL, NULL, '192.168.1.54', 'PRINTER-OPS-01', NULL, 5, 2);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'Canon imagePROGRAF PRO-300', 653, 753, 3006, 'PRT-2022-026', 'Printer', 'سيء', NULL, NULL, '192.168.1.55', 'PRINTER-CS-01', NULL, 6, 1);

-- أجهزة إضافية مختلطة
INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'Dell OptiPlex 5090', 651, 751, 1011, 'DL-2023-027', 'Desktop', 'جيد', '512GB SSD', '16GB', '192.168.1.20', 'PC-IT-03', 452, 1, 2);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'HP EliteDesk 800 G8', 651, 751, 1012, 'HP-2023-028', 'Desktop', 'جيد', '1TB SSD', '32GB', '192.168.1.21', 'PC-ADMIN-02', 452, 1, 1);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'Lenovo ThinkCentre M90a', 651, 751, 1013, 'LN-2023-029', 'Desktop', 'متوسط', '256GB SSD', '8GB', '192.168.1.22', 'PC-FIN-03', NULL, 2, 2);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'HP ProDesk 600 G6', 651, 751, 1014, 'HP-2022-030', 'Desktop', 'جيد', '512GB SSD', '16GB', '192.168.1.23', 'PC-HR-03', NULL, 3, 3);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'Dell Latitude 5520', 652, 752, 2011, 'DLL-2023-031', 'Laptop', 'جيد', '512GB SSD', '16GB', 'DHCP', 'LT-MKT-02', 455, 4, 3);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'HP ProBook 650 G8', 652, 752, 2012, 'HPL-2023-032', 'Laptop', 'جيد', '256GB SSD', '8GB', 'DHCP', 'LT-OPS-02', NULL, 5, 2);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'Lenovo IdeaPad 3', 652, 752, 2013, 'LNL-2022-033', 'Laptop', 'متوسط', '1TB HDD', '8GB', 'DHCP', 'LT-CS-02', NULL, 6, 1);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'Dell XPS 13 9310', 652, 752, 2014, 'DLL-2023-034', 'Laptop', 'جيد', '512GB SSD', '16GB', 'DHCP', 'LT-IT-03', 456, 1, 1);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'HP Envy 15', 652, 752, 2015, 'HPL-2023-035', 'Laptop', 'جيد', '1TB SSD', '16GB', 'DHCP', 'LT-FIN-03', 453, 2, 2);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'Canon MAXIFY MB5420', 653, 753, 3007, 'PRT-2023-036', 'Printer', 'جيد', NULL, NULL, '192.168.1.56', 'PRINTER-IT-02', NULL, 1, 2);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'HP LaserJet Enterprise M609', 653, 753, 3008, 'PRT-2023-037', 'Printer', 'جيد', NULL, NULL, '192.168.1.57', 'PRINTER-FIN-02', NULL, 2, 2);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'Canon imageCLASS LBP6030w', 653, 753, 3009, 'PRT-2022-038', 'Printer', 'متوسط', NULL, NULL, '192.168.1.58', 'PRINTER-HR-02', NULL, 3, 3);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'HP DeskJet 2755e', 653, 753, 3010, 'PRT-2023-039', 'Printer', 'جيد', NULL, NULL, '192.168.1.59', 'PRINTER-MKT-02', NULL, 4, 3);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'Dell OptiPlex 7070', 651, 751, 1015, 'DL-2022-040', 'Desktop', 'جيد', '512GB SSD', '16GB', '192.168.1.24', 'PC-MKT-02', 455, 4, 3);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'HP EliteDesk 705 G5', 651, 751, 1016, 'HP-2022-041', 'Desktop', 'متوسط', '256GB SSD', '8GB', '192.168.1.25', 'PC-OPS-02', NULL, 5, 2);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'Lenovo ThinkCentre M75s', 651, 751, 1017, 'LN-2023-042', 'Desktop', 'جيد', '1TB HDD', '16GB', '192.168.1.26', 'PC-CS-02', NULL, 6, 1);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'Dell Precision 3640', 651, 751, 1018, 'DL-2023-043', 'Desktop', 'جيد', '1TB SSD', '32GB', '192.168.1.27', 'PC-IT-04', 452, 1, 2);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ('HP Z2 Tower G5', 651, 751, 1019, 'HP-2023-044', 'Desktop', 'جيد', '2TB HDD', '64GB', '192.168.1.28', 'PC-ADMIN-03', 452, 1, 1);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'Lenovo Legion Tower 5', 651, 751, 1020, 'LN-2022-045', 'Desktop', 'سيء', '512GB SSD', '16GB', '192.168.1.29', 'PC-FIN-04', NULL, 2, 2);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'Dell Latitude 3420', 652, 752, 2016, 'DLL-2022-046', 'Laptop', 'متوسط', '256GB SSD', '8GB', 'DHCP', 'LT-HR-03', 454, 3, 3);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'HP EliteBook 845 G8', 652, 752, 2017, 'HPL-2023-047', 'Laptop', 'جيد', '512GB SSD', '16GB', 'DHCP', 'LT-MKT-03', 455, 4, 3);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'Lenovo Yoga 9i', 652, 752, 2018, 'LNL-2023-048', 'Laptop', 'جيد', '1TB SSD', '16GB', 'DHCP', 'LT-OPS-03', NULL, 5, 2);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'Dell Inspiron 16 Plus', 652, 752, 2019, 'DLL-2023-049', 'Laptop', 'جيد', '512GB SSD', '16GB', 'DHCP', 'LT-CS-03', NULL, 6, 1);

INSERT INTO far3.ITEMS (ITEM_NAME, SUB_CAT_ID, ITEM_TYPE_ID, LOCK_NUM, SERIAL, KIND, SITUATION, HDD, RAM, IP, COMP_NAME, USER_ID, DEPT_ID, FLOOR_ID)
VALUES ( 'HP Pavilion 15', 652,752, 2020, 'HPL-2022-050', 'Laptop', 'متوسط', '256GB SSD', '8GB', 'DHCP', 'LT-IT-04', 456, 1, 1);

-- ===============================================
-- ===============================================
-- Views مفيدة للاستعلامات
-- ===============================================

-- عرض الأصناف مع تفاصيل التصنيف
CREATE OR REPLACE VIEW FAR3.v_items_details AS
SELECT 
    i.item_id,
    i.item_name,
    i.serial,
    i.kind,
    i.situation,
    sc.sub_cat_name,
    mc.cat_name AS main_category,
    u.username AS assigned_user,
    u.full_name AS user_full_name,
    i.created_at,
    i.updated_at
FROM FAR3.Items i
LEFT JOIN FAR3.Sub_Categories sc ON i.sub_cat_id = sc.sub_cat_id
LEFT JOIN FAR3.Main_Categories mc ON sc.cat_id = mc.cat_id
LEFT JOIN FAR3.Users u ON i.user_id = u.user_id;

-- عرض المستخدمين مع الأدوار
CREATE OR REPLACE VIEW FAR3.v_users_with_roles AS
SELECT 
    u.user_id,
    u.username,
    u.email,
    u.full_name,
    u.phone,
    u.is_active,
    u.is_admin,
    r.name AS role_name,
    r.description AS role_description
FROM FAR3.Users u
JOIN FAR3.Roles r ON u.role_id = r.role_id;


-- ===============================================
-- حذف الصلاحيات القديمة (المتعلقة بالمستشفى)
-- ===============================================
DELETE FROM far3.ROLE_PERMISSIONS;
COMMIT;

-- ===============================================
-- إدخال صلاحيات جديدة متناسبة مع نظام إدارة الأصناف
-- ===============================================

-- ===============================================
-- 1. SUPER_ADMIN (ROLE_ID = 211) - صلاحيات كاملة
-- ===============================================
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (211, 'ALL', 'MANAGE');

-- ===============================================
-- 2. ADMIN (ROLE_ID = 212) - صلاحيات إدارية شاملة
-- ===============================================

-- إدارة المستخدمين
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (212, 'USERS', 'CREATE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (212, 'USERS', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (212, 'USERS', 'UPDATE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (212, 'USERS', 'DELETE');

-- إدارة الأصناف
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (212, 'ITEMS', 'CREATE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (212, 'ITEMS', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (212, 'ITEMS', 'UPDATE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (212, 'ITEMS', 'DELETE');

-- إدارة التصنيفات
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (212, 'CATEGORIES', 'CREATE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (212, 'CATEGORIES', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (212, 'CATEGORIES', 'UPDATE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (212, 'CATEGORIES', 'DELETE');

-- إدارة الأقسام
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (212, 'DEPARTMENTS', 'CREATE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (212, 'DEPARTMENTS', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (212, 'DEPARTMENTS', 'UPDATE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (212, 'DEPARTMENTS', 'DELETE');

-- عرض لوحة التحكم والتقارير
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (212, 'DASHBOARD', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (212, 'REPORTS', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (212, 'REPORTS', 'EXPORT');

-- ===============================================
-- 3. DOCTOR (ROLE_ID = 213) - مدير قسم / مشرف
-- ===============================================

-- عرض وتعديل الأصناف
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (213, 'ITEMS', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (213, 'ITEMS', 'UPDATE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (213, 'ITEMS', 'CREATE');

-- عرض المستخدمين في قسمه
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (213, 'USERS', 'READ');

-- عرض التصنيفات
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (213, 'CATEGORIES', 'READ');

-- عرض الأقسام
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (213, 'DEPARTMENTS', 'READ');

-- التقارير
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (213, 'REPORTS', 'READ');

-- ===============================================
-- 4. NURSE (ROLE_ID = 214) - موظف عادي
-- ===============================================

-- عرض الأصناف فقط
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (214, 'ITEMS', 'READ');

-- عرض المستخدمين
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (214, 'USERS', 'READ');

-- عرض التصنيفات
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (214, 'CATEGORIES', 'READ');

-- عرض الأقسام
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (214, 'DEPARTMENTS', 'READ');

-- ===============================================
-- 5. RECEPTIONIST (ROLE_ID = 215) - موظف استقبال / إدخال بيانات
-- ===============================================

-- إدارة الأصناف (إضافة وتعديل)
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (215, 'ITEMS', 'CREATE');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (215, 'ITEMS', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (215, 'ITEMS', 'UPDATE');

-- عرض المستخدمين
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (215, 'USERS', 'READ');

-- عرض وإضافة التصنيفات
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (215, 'CATEGORIES', 'READ');
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (215, 'CATEGORIES', 'CREATE');

-- عرض الأقسام
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (215, 'DEPARTMENTS', 'READ');

-- ===============================================
-- 6. PATIENT (ROLE_ID = 216) - مستخدم عادي / عرض فقط
-- ===============================================

-- عرض الأصناف الخاصة به فقط
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (216, 'ITEMS', 'READ');

-- عرض التصنيفات
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (216, 'CATEGORIES', 'READ');

-- عرض الأقسام
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION) 
VALUES (216, 'DEPARTMENTS', 'READ');

-- صلاحيات محدودة لعرض بيانات المستخدمين
INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION, FIELD_NAME, CAN_ACCESS) 
VALUES (216, 'USERS', 'READ', 'username', 1);

INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION, FIELD_NAME, CAN_ACCESS) 
VALUES (216, 'USERS', 'READ', 'full_name', 1);

INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION, FIELD_NAME, CAN_ACCESS) 
VALUES (216, 'USERS', 'READ', 'phone', 1);

INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION, FIELD_NAME, CAN_ACCESS) 
VALUES (216, 'USERS', 'READ', 'email', 0);

INSERT INTO far3.ROLE_PERMISSIONS (ROLE_ID, SUBJECT, ACTION, FIELD_NAME, CAN_ACCESS) 
VALUES (216, 'USERS', 'READ', 'password', 0);

COMMIT;

-- ===============================================
-- تحديث أسماء وأوصاف الأدوار لتتناسب مع النظام
-- ===============================================

UPDATE far3.ROLES 
SET NAME = 'SUPER_ADMIN', 
    DESCRIPTION = 'مدير النظام الرئيسي - صلاحيات كاملة على جميع الوظائف'
WHERE ROLE_ID = 211;

UPDATE far3.ROLES 
SET NAME = 'ADMIN', 
    DESCRIPTION = 'مدير النظام - إدارة المستخدمين والأصناف والتقارير'
WHERE ROLE_ID = 212;

UPDATE far3.ROLES 
SET NAME = 'SUPERVISOR', 
    DESCRIPTION = 'مشرف قسم - إدارة الأصناف وعرض التقارير'
WHERE ROLE_ID = 213;

UPDATE far3.ROLES 
SET NAME = 'EMPLOYEE', 
    DESCRIPTION = 'موظف عادي - عرض البيانات فقط'
WHERE ROLE_ID = 214;

UPDATE far3.ROLES 
SET NAME = 'DATA_ENTRY', 
    DESCRIPTION = 'موظف إدخال بيانات - إضافة وتعديل الأصناف'
WHERE ROLE_ID = 215;

UPDATE far3.ROLES 
SET NAME = 'VIEWER', 
    DESCRIPTION = 'مستخدم عادي - عرض محدود للبيانات'
WHERE ROLE_ID = 216;

COMMIT;

-- ===============================================
-- عرض ملخص الصلاحيات
-- ===============================================

SELECT 
    r.NAME AS ROLE_NAME,
    r.DESCRIPTION,
    rp.SUBJECT,
    rp.ACTION,
    rp.FIELD_NAME,
    rp.CAN_ACCESS
FROM far3.ROLES r
LEFT JOIN far3.ROLE_PERMISSIONS rp ON r.ROLE_ID = rp.ROLE_ID
ORDER BY r.ROLE_ID, rp.SUBJECT, rp.ACTION;


------**********************-------------------
-- ===============================================
-- 1. إضافة حقل الكمية لجدول الأصناف
-- ===============================================

-- إضافة عمود الكمية المتاحة للأصناف الموجودة
ALTER TABLE far3.ITEMS ADD (
    QUANTITY NUMBER DEFAULT 0 NOT NULL,
    MIN_QUANTITY NUMBER DEFAULT 0,
    UNIT VARCHAR2(50) DEFAULT 'قطعة'
);

COMMENT ON COLUMN far3.ITEMS.QUANTITY IS 'الكمية المتاحة في المخزن';
COMMENT ON COLUMN far3.ITEMS.MIN_QUANTITY IS 'الحد الأدنى للكمية (تنبيه نقص مخزون)';
COMMENT ON COLUMN far3.ITEMS.UNIT IS 'وحدة القياس (قطعة، كرتونة، وحدة، إلخ)';

-- ===============================================
-- 2. جدول أنواع الحركات
-- ===============================================

CREATE TABLE far3.MOVEMENT_TYPES (
    MOVEMENT_TYPE_ID NUMBER PRIMARY KEY,
    TYPE_NAME VARCHAR2(100) NOT NULL UNIQUE,
    TYPE_CODE VARCHAR2(20) NOT NULL UNIQUE,
    EFFECT NUMBER(2) NOT NULL, -- 1 للزيادة، -1 للنقصان
    DESCRIPTION VARCHAR2(500),
    IS_ACTIVE NUMBER(1) DEFAULT 1,
    CREATED_AT DATE DEFAULT SYSDATE
);

COMMENT ON TABLE far3.MOVEMENT_TYPES IS 'أنواع حركات المخزون';
COMMENT ON COLUMN far3.MOVEMENT_TYPES.EFFECT IS '1 = زيادة، -1 = نقصان';

-- إدراج أنواع الحركات الأساسية
INSERT INTO far3.MOVEMENT_TYPES (MOVEMENT_TYPE_ID, TYPE_NAME, TYPE_CODE, EFFECT, DESCRIPTION)
VALUES (1, 'إدخال مخزون', 'IN', 1, 'إضافة كمية جديدة للمخزن');

INSERT INTO far3.MOVEMENT_TYPES (MOVEMENT_TYPE_ID, TYPE_NAME, TYPE_CODE, EFFECT, DESCRIPTION)
VALUES (2, 'إخراج مخزون', 'OUT', -1, 'صرف كمية من المخزن');

INSERT INTO far3.MOVEMENT_TYPES (MOVEMENT_TYPE_ID, TYPE_NAME, TYPE_CODE, EFFECT, DESCRIPTION)
VALUES (3, 'مرتجع', 'RETURN', 1, 'إرجاع كمية للمخزن');

INSERT INTO far3.MOVEMENT_TYPES (MOVEMENT_TYPE_ID, TYPE_NAME, TYPE_CODE, EFFECT, DESCRIPTION)
VALUES (4, 'تالف', 'DAMAGED', -1, 'كمية تالفة تم استبعادها');

INSERT INTO far3.MOVEMENT_TYPES (MOVEMENT_TYPE_ID, TYPE_NAME, TYPE_CODE, EFFECT, DESCRIPTION)
VALUES (5, 'جرد', 'ADJUSTMENT', 0, 'تعديل الكمية بناءً على الجرد الفعلي');

INSERT INTO far3.MOVEMENT_TYPES (MOVEMENT_TYPE_ID, TYPE_NAME, TYPE_CODE, EFFECT, DESCRIPTION)
VALUES (6, 'نقل بين أقسام', 'TRANSFER', 0, 'نقل كمية من قسم لآخر');

-- ===============================================
-- 3. جدول حركات المخزون (الرئيسي)
-- ===============================================

CREATE TABLE far3.INVENTORY_MOVEMENTS (
    MOVEMENT_ID NUMBER PRIMARY KEY,
    ITEM_ID NUMBER NOT NULL,
    MOVEMENT_TYPE_ID NUMBER NOT NULL,
    QUANTITY NUMBER NOT NULL,
    PREVIOUS_QTY NUMBER,
    NEW_QTY NUMBER,
    MOVEMENT_DATE DATE DEFAULT SYSDATE,
    USER_ID NUMBER NOT NULL,
    FROM_DEPT_ID NUMBER,
    TO_DEPT_ID NUMBER,
    FROM_FLOOR_ID NUMBER,
    TO_FLOOR_ID NUMBER,
    REFERENCE_NO VARCHAR2(100),
    NOTES VARCHAR2(500),
    CREATED_AT DATE DEFAULT SYSDATE,
    -- Foreign Keys
    CONSTRAINT FK_MOVEMENT_ITEM FOREIGN KEY (ITEM_ID) 
        REFERENCES far3.ITEMS(ITEM_ID) ON DELETE CASCADE,
    CONSTRAINT FK_MOVEMENT_TYPE FOREIGN KEY (MOVEMENT_TYPE_ID) 
        REFERENCES far3.MOVEMENT_TYPES(MOVEMENT_TYPE_ID),
    CONSTRAINT FK_MOVEMENT_USER FOREIGN KEY (USER_ID) 
        REFERENCES far3.USERS(USER_ID),
    CONSTRAINT FK_MOVEMENT_FROM_DEPT FOREIGN KEY (FROM_DEPT_ID) 
        REFERENCES far3.DEPARTMENTS(DEPT_ID),
    CONSTRAINT FK_MOVEMENT_TO_DEPT FOREIGN KEY (TO_DEPT_ID) 
        REFERENCES far3.DEPARTMENTS(DEPT_ID),
    CONSTRAINT FK_MOVEMENT_FROM_FLOOR FOREIGN KEY (FROM_FLOOR_ID) 
        REFERENCES far3.FLOORS(FLOOR_ID),
    CONSTRAINT FK_MOVEMENT_TO_FLOOR FOREIGN KEY (TO_FLOOR_ID) 
        REFERENCES far3.FLOORS(FLOOR_ID)
);

COMMENT ON TABLE far3.INVENTORY_MOVEMENTS IS 'سجل حركات المخزون';

-- Indexes للأداء
CREATE INDEX far3.IDX_MOVEMENT_ITEM ON far3.INVENTORY_MOVEMENTS(ITEM_ID);
CREATE INDEX far3.IDX_MOVEMENT_DATE ON far3.INVENTORY_MOVEMENTS(MOVEMENT_DATE);
CREATE INDEX far3.IDX_MOVEMENT_TYPE ON far3.INVENTORY_MOVEMENTS(MOVEMENT_TYPE_ID);
CREATE INDEX far3.IDX_MOVEMENT_USER ON far3.INVENTORY_MOVEMENTS(USER_ID);

-- Sequence للـ Primary Key
CREATE SEQUENCE far3.MOVEMENT_ID START WITH 1 INCREMENT BY 1;

-- Trigger للـ Auto Increment
CREATE OR REPLACE TRIGGER far3.trg_MOVEMENT_ID
BEFORE INSERT ON far3.INVENTORY_MOVEMENTS
FOR EACH ROW
BEGIN
  :NEW.MOVEMENT_ID := TO_NUMBER('95' || far3.MOVEMENT_ID.NEXTVAL);
END;
/

-- ===============================================
-- 4. Procedure لإضافة حركة مخزون
-- ===============================================

CREATE OR REPLACE PROCEDURE far3.ADD_INVENTORY_MOVEMENT (
    p_item_id IN NUMBER,
    p_movement_type_id IN NUMBER,
    p_quantity IN NUMBER,
    p_user_id IN NUMBER,
    p_reference_no IN VARCHAR2 DEFAULT NULL,
    p_notes IN VARCHAR2 DEFAULT NULL,
    p_from_dept_id IN NUMBER DEFAULT NULL,
    p_to_dept_id IN NUMBER DEFAULT NULL,
    p_from_floor_id IN NUMBER DEFAULT NULL,
    p_to_floor_id IN NUMBER DEFAULT NULL,
    p_movement_id OUT NUMBER
) AS
    v_current_qty NUMBER;
    v_new_qty NUMBER;
    v_effect NUMBER;
    v_type_code VARCHAR2(20);
BEGIN
    -- الحصول على الكمية الحالية
    SELECT QUANTITY INTO v_current_qty
    FROM far3.ITEMS
    WHERE ITEM_ID = p_item_id
    FOR UPDATE;
    
    -- الحصول على تأثير نوع الحركة
    SELECT EFFECT, TYPE_CODE INTO v_effect, v_type_code
    FROM far3.MOVEMENT_TYPES
    WHERE MOVEMENT_TYPE_ID = p_movement_type_id;
    
    -- حساب الكمية الجديدة
    IF v_type_code = 'ADJUSTMENT' THEN
        -- في حالة الجرد، الكمية المدخلة هي الكمية الجديدة
        v_new_qty := p_quantity;
    ELSE
        v_new_qty := v_current_qty + (p_quantity * v_effect);
    END IF;
    
    -- التحقق من عدم وجود كمية سالبة
    IF v_new_qty < 0 THEN
        RAISE_APPLICATION_ERROR(-20001, 'الكمية المتاحة غير كافية للصرف');
    END IF;
    
    -- إضافة سجل الحركة
    INSERT INTO far3.INVENTORY_MOVEMENTS (
        ITEM_ID, MOVEMENT_TYPE_ID, QUANTITY, PREVIOUS_QTY, NEW_QTY,
        USER_ID, REFERENCE_NO, NOTES,
        FROM_DEPT_ID, TO_DEPT_ID, FROM_FLOOR_ID, TO_FLOOR_ID
    ) VALUES (
        p_item_id, p_movement_type_id, p_quantity, v_current_qty, v_new_qty,
        p_user_id, p_reference_no, p_notes,
        p_from_dept_id, p_to_dept_id, p_from_floor_id, p_to_floor_id
    ) RETURNING MOVEMENT_ID INTO p_movement_id;
    
    -- تحديث كمية الصنف
    UPDATE far3.ITEMS
    SET QUANTITY = v_new_qty,
        UPDATED_AT = SYSDATE
    WHERE ITEM_ID = p_item_id;
    
    COMMIT;
    
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        RAISE_APPLICATION_ERROR(-20002, 'الصنف أو نوع الحركة غير موجود');
    WHEN OTHERS THEN
        ROLLBACK;
        RAISE;
END;
/

-- ===============================================
-- 5. Views مفيدة
-- ===============================================

-- عرض حركات المخزون مع التفاصيل
CREATE OR REPLACE VIEW far3.V_INVENTORY_MOVEMENTS AS
SELECT 
    im.MOVEMENT_ID,
    i.ITEM_NAME,
    i.SERIAL,
    mt.TYPE_NAME AS MOVEMENT_TYPE,
    mt.TYPE_CODE,
    im.QUANTITY,
    im.PREVIOUS_QTY,
    im.NEW_QTY,
    im.MOVEMENT_DATE,
    u.FULL_NAME AS USER_NAME,
    fd.DEPT_NAME AS FROM_DEPT,
    td.DEPT_NAME AS TO_DEPT,
    ff.FLOOR_NAME AS FROM_FLOOR,
    tf.FLOOR_NAME AS TO_FLOOR,
    im.REFERENCE_NO,
    im.NOTES
FROM far3.INVENTORY_MOVEMENTS im
JOIN far3.ITEMS i ON im.ITEM_ID = i.ITEM_ID
JOIN far3.MOVEMENT_TYPES mt ON im.MOVEMENT_TYPE_ID = mt.MOVEMENT_TYPE_ID
JOIN far3.USERS u ON im.USER_ID = u.USER_ID
LEFT JOIN far3.DEPARTMENTS fd ON im.FROM_DEPT_ID = fd.DEPT_ID
LEFT JOIN far3.DEPARTMENTS td ON im.TO_DEPT_ID = td.DEPT_ID
LEFT JOIN far3.FLOORS ff ON im.FROM_FLOOR_ID = ff.FLOOR_ID
LEFT JOIN far3.FLOORS tf ON im.TO_FLOOR_ID = tf.FLOOR_ID
ORDER BY im.MOVEMENT_DATE DESC;

-- عرض الأصناف القريبة من النفاد
CREATE OR REPLACE VIEW far3.V_LOW_STOCK_ITEMS AS
SELECT 
    i.ITEM_ID,
    i.ITEM_NAME,
    i.SERIAL,
    i.QUANTITY,
    i.MIN_QUANTITY,
    i.UNIT,
    d.DEPT_NAME,
    f.FLOOR_NAME,
    sc.SUB_CAT_NAME,
    (i.MIN_QUANTITY - i.QUANTITY) AS SHORTAGE_QTY
FROM far3.ITEMS i
LEFT JOIN far3.DEPARTMENTS d ON i.DEPT_ID = d.DEPT_ID
LEFT JOIN far3.FLOORS f ON i.FLOOR_ID = f.FLOOR_ID
LEFT JOIN far3.SUB_CATEGORIES sc ON i.SUB_CAT_ID = sc.SUB_CAT_ID
WHERE i.QUANTITY <= i.MIN_QUANTITY
ORDER BY (i.MIN_QUANTITY - i.QUANTITY) DESC;

-- ===============================================
-- 6. أمثلة على الاستخدام
-- ===============================================

-- مثال 1: إدخال 50 قطعة من صنف معين
DECLARE
    v_movement_id NUMBER;
BEGIN
    far3.ADD_INVENTORY_MOVEMENT(
        p_item_id => 851,           -- معرف الصنف
        p_movement_type_id => 1,     -- إدخال مخزون
        p_quantity => 50,            -- الكمية
        p_user_id => 451,            -- المستخدم
        p_reference_no => 'PO-2024-001',
        p_notes => 'توريد دفعة جديدة',
        p_movement_id => v_movement_id
    );
    DBMS_OUTPUT.PUT_LINE('تم إضافة الحركة رقم: ' || v_movement_id);
END;
/

-- مثال 2: صرف 10 قطع
DECLARE
    v_movement_id NUMBER;
BEGIN
    far3.ADD_INVENTORY_MOVEMENT(
        p_item_id => 851,
        p_movement_type_id => 2,     -- إخراج مخزون
        p_quantity => 10,
        p_user_id => 451,
        p_reference_no => 'REQ-2024-001',
        p_notes => 'صرف لقسم تكنولوجيا المعلومات',
        p_to_dept_id => 1,
        p_movement_id => v_movement_id
    );
    DBMS_OUTPUT.PUT_LINE('تم صرف 10 قطع');
END;
/

-- مثال 3: تعديل جرد (الكمية الفعلية 35)
DECLARE
    v_movement_id NUMBER;
BEGIN
    far3.ADD_INVENTORY_MOVEMENT(
        p_item_id => 851,
        p_movement_type_id => 5,     -- جرد
        p_quantity => 35,            -- الكمية الفعلية
        p_user_id => 451,
        p_notes => 'جرد شهري',
        p_movement_id => v_movement_id
    );
END;
/

-- ===============================================
-- 7. استعلامات مفيدة
-- ===============================================

-- عرض جميع حركات صنف معين
SELECT * FROM far3.V_INVENTORY_MOVEMENTS
WHERE ITEM_NAME LIKE '%Dell%'
ORDER BY MOVEMENT_DATE DESC;

-- عرض الأصناف القريبة من النفاد
SELECT * FROM far3.V_LOW_STOCK_ITEMS;

-- إجمالي الحركات حسب النوع
SELECT 
    mt.TYPE_NAME,
    COUNT(*) AS MOVEMENT_COUNT,
    SUM(im.QUANTITY) AS TOTAL_QUANTITY
FROM far3.INVENTORY_MOVEMENTS im
JOIN far3.MOVEMENT_TYPES mt ON im.MOVEMENT_TYPE_ID = mt.MOVEMENT_TYPE_ID
GROUP BY mt.TYPE_NAME
ORDER BY MOVEMENT_COUNT DESC;

-- رصيد كل صنف
SELECT 
    i.ITEM_NAME,
    i.SERIAL,
    i.QUANTITY,
    i.MIN_QUANTITY,
    i.UNIT,
    CASE 
        WHEN i.QUANTITY <= i.MIN_QUANTITY THEN 'تحذير: نقص مخزون'
        WHEN i.QUANTITY = 0 THEN 'منتهي'
        ELSE 'متاح'
    END AS STATUS
FROM far3.ITEMS i
ORDER BY i.QUANTITY ASC;

COMMIT;